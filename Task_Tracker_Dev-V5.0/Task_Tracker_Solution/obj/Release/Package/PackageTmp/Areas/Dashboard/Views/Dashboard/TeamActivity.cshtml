@model  Task_Tracker_CommonLibrary.DomainModels.DashBoard
@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@*<script src="~/Scripts/Chart.min.js"></script>*@
<script src="~/Areas/Dashboard/Views/Dashboard/Dashboard.js"></script>

<link href="~/Content/jqgrid/grid-jquery-ui.min.css" rel="stylesheet" />
<link href="~/Content/jqgrid/ui.jqgrid.min.css" rel="stylesheet" />
<script src="~/Content/jqgrid/jquery.jqgrid.min.js"></script>
<script>
    //<![CDATA[
    function storeFilterData() {
        var startDate = '', endDate = '';

        try {

            startDate = $('#txtstart_date').val();
            endtDate = $('#txtend_date').val();
            
            var FilterData = "{'StartDate':'" + startDate + "', 'EndDate':'" + endtDate + "'}";
            setCookie('TeamActivityData', FilterData, 5);
        } catch (e) {
            alert(e.message);
        }
    }

    var dta = '';

    $(document).ready(function () {
        dta = '@Html.Raw(Model.JsonProjectUsersData)';
        //dta = dta.replaceAll('emp_name', 'Employee');
        //dta = dta.replaceAll('project_name', 'Project');
        $("#grid").jqGrid({
            //colNames: ["Employee", "Project", "Module", "Hours Worked"],
            colModel: [
                //{ name: "Sr No" },
                { label: 'Employee', name: "emp_name", sortable: true }, //, searchoptions: { defaultValue: 'Aarti Mahale', value: { "": "Aarti Mahale", "Divyanand Tiwari": "Pankaj Verma", "Closed": "Closed", }, sopt: ['eq'] }
                { label: "Project", name: "project_name", sortable: true },
                { label: "Module", name: "module_name", sortable: true },
                { label: "Hours Worked", name: "hours_spent", template: "number", search: false },
                {
                    label: "Days Worked", name: "days_spent", template: "number", search: false,
                    summaryTpl: "Total: {0}", // set the summary template to show the group summary
                    summaryType: "sum" // set the formula to calculate the summary type
                }
            ],
            data: JSON.parse(dta),
            iconSet: "fontAwesome",
            idPrefix: "gU_",
            rownumbers: true,
            sortable: true,
            // threeStateSort: true,
            sortIconsBeforeText: true,
            headertitles: true,
            //toppager: true,
            pager: true,
            rowNum: 30,
            viewrecords: true,
            width: 1020, //"auto",
            searching: {
                defaultSearch: "cn"
            },
            footerrow: true, // set a footer row
            userDataOnFooter: true, // the calculated sums and/or strings from server are put at footer row.
            grouping: true,
            groupingView: {
                groupField: ["emp_name"],
                groupColumnShow: [true],
                groupText: ["<b>{0}</b>"],
                groupOrder: ["asc"],
                groupSummary: [true],
                groupCollapse: false                    
            },
            gridComplete: function () {                
                var $grid = $('#grid');
                var colSum = $grid.jqGrid('getCol', 'days_spent', false, 'sum');                
                $grid.jqGrid('footerData', 'set', { emp_name: 'Grand Total:', days_spent: colSum});
            },
            caption: "" //Employee-Project Hours Worked

        }).jqGrid("filterToolbar");
    });

    //$(function () {
    //    "use strict";
    //    $("#grid").jqGrid({
    //        colModel: [
    //            //{ name: "Sr No" },
    //            { label: 'Employee', name: "emp_name", sortable: true },
    //            { label: "Project", name: "project_name", sortable: true },
    //            { label: "Module", name: "module_name", sortable: true },
    //            { label: "Hours", name: "hours_spent", template: "number", search: false }
    //        ],
    //        data: JSON.parse(dta),

    //        iconSet: "fontAwesome",
    //        idPrefix: "gU_",
    //        rownumbers: true,
    //        sortable: true,
    //        // threeStateSort: true,
    //        sortIconsBeforeText: true,
    //        headertitles: true,
    //        //toppager: true,
    //        pager: true,
    //        rowNum: 10,
    //        viewrecords: true,
    //        width: 1020, //"auto",
    //        searching: {
    //            defaultSearch: "cn"
    //        },
    //        caption: "" //Employee-Project Hours Worked

    //    }).jqGrid("filterToolbar");;
    //});
    //]]>
</script>

<script>
    @*    //<![CDATA[
    $(function () {
        "use strict";
        $("#grid1").jqGrid({
            colModel: [
                { name: "name", label: "Client", width: 53 },
                { name: "invdate", label: "Date", width: 75, align: "center", sorttype: "date",
                    formatter: "date", formatoptions: { newformat: "d-M-Y" } },
                { name: "amount", label: "Amount", width: 65, template: "number" },
                { name: "tax", label: "Tax", width: 41, template: "number" },
                { name: "total", label: "Total", width: 51, template: "number" },
                { name: "closed", label: "Closed", width: 59, template: "booleanCheckbox", firstsortorder: "desc" },
                { name: "ship_via", label: "Shipped via", width: 87, align: "center", formatter: "select",
                    formatoptions: { value: "FE:FedEx;TN:TNT;DH:DHL", defaultValue: "DH" } }
            ],
            data: [
                { id: "10",  invdate: "2015-10-01", name: "test",   amount: "" },
                { id: "20",  invdate: "2015-09-01", name: "test2",  amount: "300.00", tax:"20.00", closed:false, ship_via:"FE", total:"320.00"},
                { id: "30",  invdate: "2015-09-01", name: "test3",  amount: "400.00", tax:"30.00", closed:false, ship_via:"FE", total:"430.00"},
                { id: "40",  invdate: "2015-10-04", name: "test4",  amount: "200.00", tax:"10.00", closed:true,  ship_via:"TN", total:"210.00"},
                { id: "50",  invdate: "2015-10-31", name: "test5",  amount: "300.00", tax:"20.00", closed:false, ship_via:"FE", total:"320.00"},
                { id: "60",  invdate: "2015-09-06", name: "test6",  amount: "400.00", tax:"30.00", closed:false, ship_via:"FE", total:"430.00"},
                { id: "70",  invdate: "2015-10-04", name: "test7",  amount: "200.00", tax:"10.00", closed:true,  ship_via:"TN", total:"210.00"},
                { id: "80",  invdate: "2015-10-03", name: "test8",  amount: "300.00", tax:"20.00", closed:false, ship_via:"FE", total:"320.00"},
                { id: "90",  invdate: "2015-09-01", name: "test9",  amount: "400.00", tax:"30.00", closed:false, ship_via:"TN", total:"430.00"},
                { id: "100", invdate: "2015-09-08", name: "test10", amount: "500.00", tax:"30.00", closed:true,  ship_via:"TN", total:"530.00"},
                { id: "110", invdate: "2015-09-08", name: "test11", amount: "500.00", tax:"30.00", closed:false, ship_via:"FE", total:"530.00"},
                { id: "120", invdate: "2015-09-10", name: "test12", amount: "500.00", tax:"30.00", closed:false, ship_via:"FE", total:"530.00"}
            ],
            iconSet: "fontAwesome",
            idPrefix: "g1_",
            rownumbers: true,
            sortname: "invdate",
            sortorder: "desc",
            caption: "The grid, which uses predefined formatters and templates"
        });
    });
    //]]>*@
</script>

<div class="app-page-title">
    <div class="page-title-wrapper">
        <div class="page-title-heading">
            <div class="page-title-icon">
                <i class="pe-7s-display1 icon-gradient bg-premium-dark">
                </i>
            </div>
            <div>Team Activity</div>
        </div>
    </div>
</div>

<div class="main-card mb-3 card">
    <div class="card-header border-0">
        Team Activity
    </div>
    <div class="card-body pt-0">
        <div>

            @using (Ajax.BeginForm("TeamActivity", "Dashboard", new AjaxOptions
            {
                HttpMethod = "post",
                OnSuccess = "OnSuccess",
            }, new { id = "Form", EncType = "multipart/form-data" }))
            {
                <div class="form-row">
                    <div class="col-md-5">
                        <div class="position-relative form-group mb-2">
                            <label for="exampleEmail11" class="">From Date</label>
                            <div class="input-group">
                                @Html.TextBoxFor(model => model.startdate, new { @class = "form-control", @id = "txtstart_date", data_toggle = "datepicker", autocomplete = "off" })

                                <div class="input-group-append">
                                    <div class="input-group-text">
                                        <i class="fa fa-calendar-alt"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="position-relative form-group mb-2">
                            <label for="exampleEmail11" class="">To Date</label>
                            <div class="input-group">
                                @Html.TextBoxFor(model => model.enddate, new { @class = "form-control", @id = "txtend_date", data_toggle = "datepicker", autocomplete = "off" })
                                <div class="input-group-append">
                                    <div class="input-group-text">
                                        <i class="fa fa-calendar-alt"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-1 dashtogglebtn">
                        <button type="submit" class="btn btn-focus mt-4" onclick="storeFilterData();">Go</button>
                    </div>
                </div>
            }
        </div>
        <div><table id="grid"></table></div>
        @*<table id="grid1"></table>*@
    </div>
</div>
